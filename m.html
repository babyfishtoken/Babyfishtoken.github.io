<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Balance Checker</title>
</head>
<body style="background:#0f172a;color:white;font-family:sans-serif;padding:20px;text-align:center;">

<h2>ğŸ” Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù†</h2>

<!-- Ø¯Ú©Ù…Ù‡ Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ -->
<div id="wallet-btn"></div>
<div id="walletAddress" style="margin:10px;color:#94a3b8;font-size:14px;"></div>

<!-- ÙØ±Ù… Ø¬Ø³ØªØ¬Ùˆ -->
<div style="max-width:400px;margin:20px auto;">
    <select id="networkSelect" style="width:100%;padding:10px;margin-bottom:10px;background:#1e293b;color:white;border:1px solid #334155;border-radius:8px;">
        <option value="1">Ø§ØªØ±ÛŒÙˆÙ… (Ethereum)</option>
        <option value="137" selected>Ù¾Ø§Ù„ÛŒÚ¯Ø§Ù† (Polygon)</option>
        <option value="56">BSC</option>
    </select>
    
    <input type="text" id="tokenAddress" placeholder="Ø¢Ø¯Ø±Ø³ ØªÙˆÚ©Ù† (0x...)" value="0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174" style="width:100%;padding:10px;margin-bottom:10px;background:#1e293b;color:white;border:1px solid #334155;border-radius:8px;">
    
    <button id="checkBtn" onclick="checkBalance()" disabled style="width:100%;padding:12px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;">Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</button>
</div>

<!-- Ù†ØªÛŒØ¬Ù‡ -->
<div id="result" style="margin-top:20px;"></div>

<script type="module">
import { createWeb3Modal, defaultWagmiConfig } from "https://esm.sh/@web3modal/wagmi";
import { mainnet, polygon, bsc } from "https://esm.sh/wagmi/chains";
import { getAccount, watchAccount } from "https://esm.sh/wagmi/actions";
import { readContract } from "https://esm.sh/wagmi/actions";
import { formatUnits } from "https://esm.sh/viem";

// ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª ====================
const projectId = "96f13374b0fe2f629a925617de0a2ba3";
const chains = [mainnet, polygon, bsc];

const wagmiConfig = defaultWagmiConfig({
    chains,
    projectId,
    metadata: { name: "Token Checker", description: "", url: window.location.href, icons: [] }
});

// Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡
createWeb3Modal({ wagmiConfig, projectId, chains });
const btn = document.createElement("w3m-button");
document.getElementById("wallet-btn").appendChild(btn);

// ==================== ABI ØªÙˆÚ©Ù† ====================
const ERC20_ABI = [
    { "constant": true, "inputs": [], "name": "symbol", "outputs": [{"name": "", "type": "string"}], "type": "function" },
    { "constant": true, "inputs": [], "name": "decimals", "outputs": [{"name": "", "type": "uint8"}], "type": "function" },
    { "constant": true, "inputs": [{"name": "_owner", "type": "address"}], "name": "balanceOf", "outputs": [{"name": "balance", "type": "uint256"}], "type": "function" }
];

// ==================== Ù…Ù¾ Ø´Ø¨Ú©Ù‡ ====================
const chainMap = { '1': mainnet, '137': polygon, '56': bsc };

// ==================== ÙˆØ¶Ø¹ÛŒØª Ú©ÛŒÙ Ù¾ÙˆÙ„ ====================
let currentAccount = null;

watchAccount(wagmiConfig, {
    onChange(account) {
        if (account?.address) {
            currentAccount = account.address;
            document.getElementById('walletAddress').innerText = `âœ… ${account.address.slice(0,6)}...${account.address.slice(38)}`;
            document.getElementById('checkBtn').disabled = false;
        } else {
            currentAccount = null;
            document.getElementById('walletAddress').innerText = '';
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('result').innerHTML = '';
        }
    }
});

// ==================== Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ====================
window.checkBalance = async function() {
    const tokenAddress = document.getElementById('tokenAddress').value.trim();
    const network = document.getElementById('networkSelect').value;
    
    if (!tokenAddress || !tokenAddress.match(/^0x[a-fA-F0-9]{40}$/)) {
        document.getElementById('result').innerHTML = '<div style="color:#ef4444;">âŒ Ø¢Ø¯Ø±Ø³ Ù†Ø§Ù…Ø¹ØªØ¨Ø±</div>';
        return;
    }
    
    if (!currentAccount) {
        document.getElementById('result').innerHTML = '<div style="color:#ef4444;">âŒ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª</div>';
        return;
    }
    
    document.getElementById('result').innerHTML = '<div>â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</div>';
    
    try {
        const chain = chainMap[network];
        const [symbol, decimals, balance] = await Promise.all([
            readContract(wagmiConfig, { address: tokenAddress, abi: ERC20_ABI, functionName: 'symbol', chainId: chain.id }),
            readContract(wagmiConfig, { address: tokenAddress, abi: ERC20_ABI, functionName: 'decimals', chainId: chain.id }),
            readContract(wagmiConfig, { address: tokenAddress, abi: ERC20_ABI, functionName: 'balanceOf', args: [currentAccount], chainId: chain.id })
        ]);
        
        const formattedBalance = formatUnits(balance, decimals);
        const balanceNum = parseFloat(formattedBalance);
        
        if (balanceNum > 0) {
            document.getElementById('result').innerHTML = `
                <div style="background:#1e293b;padding:20px;border-radius:8px;">
                    <div style="color:#94a3b8;">${symbol}</div>
                    <div style="font-size:32px;font-weight:bold;color:#3b82f6;">${balanceNum.toLocaleString()}</div>
                    <div style="color:#22c55e;">âœ… Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„</div>
                </div>
            `;
        } else {
            document.getElementById('result').innerHTML = `
                <div style="background:#1e293b;padding:20px;border-radius:8px;">
                    <div style="color:#94a3b8;">${symbol}</div>
                    <div style="font-size:32px;font-weight:bold;color:#ef4444;">0</div>
                    <div style="color:#ef4444;">âŒ Ø¯Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù†ÛŒØ³Øª</div>
                </div>
            `;
        }
    } catch (error) {
        document.getElementById('result').innerHTML = `<div style="color:#ef4444;">âŒ Ø®Ø·Ø§: ${error.message.slice(0,50)}</div>`;
    }
}
</script>

</body>
</html>
