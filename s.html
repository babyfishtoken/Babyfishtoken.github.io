<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø§ Ø§ÛŒÙ†ÙÙˆØ±Ø§</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <style>
        body { font-family: system-ui; background: #0B0F1C; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #141A29; padding: 40px; border-radius: 32px; width: 400px; border: 1px solid #242C3A; }
        h2 { color: white; margin: 0 0 8px; }
        p { color: #7E8A9A; margin-bottom: 30px; }
        button { width: 100%; padding: 16px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border: none; border-radius: 16px; color: white; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
        .info { background: #1E2638; border-radius: 16px; padding: 20px; display: none; }
        .info div { margin-bottom: 15px; }
        .label { color: #7E8A9A; font-size: 12px; }
        .value { color: white; word-break: break-all; background: #0F1622; padding: 10px; border-radius: 8px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸš€ CreateMyToken</h2>
        <p>Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø§ Ø²ÛŒØ±Ø³Ø§Ø®Øª Ø§ÛŒÙ†ÙÙˆØ±Ø§</p>
        
        <button onclick="connectWallet()">
            <span id="btnText">Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„</span>
        </button>

        <div class="info" id="walletInfo">
            <div>
                <div class="label">ğŸ“Œ Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„</div>
                <div class="value" id="address">-</div>
            </div>
            <div>
                <div class="label">â›“ï¸ Ø´Ø¨Ú©Ù‡ (Ø§Ø² Ø§ÛŒÙ†ÙÙˆØ±Ø§)</div>
                <div class="value" id="network">-</div>
            </div>
            <div>
                <div class="label">ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ (Ø§Ø² Ø§ÛŒÙ†ÙÙˆØ±Ø§)</div>
                <div class="value" id="balance">-</div>
            </div>
            <button onclick="disconnect()" style="background: rgba(239,68,68,0.1); color: #ef4444; margin-top: 10px;">Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„</button>
        </div>
    </div>

    <script>
        // Project ID Ø§ÛŒÙ†ÙÙˆØ±Ø§ (Ù‡Ù…ÙˆÙ†ÛŒ Ú©Ù‡ ÙØ±Ø³ØªØ§Ø¯ÛŒ)
        const INFURA_ID = '934a2ae012c840dea039c5c2571bce16';
        
        // Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§ÛŒÙ†ÙÙˆØ±Ø§ (Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª)
        const infuraProvider = `https://polygon-mainnet.infura.io/v3/${INFURA_ID}`;
        const infuraWeb3 = new Web3(infuraProvider);
        
        let userAccount = null;
        let walletProvider = null;

        async function connectWallet() {
            try {
                // 1. Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ (MetaMask)
                if (!window.ethereum) {
                    alert('Ù„Ø·ÙØ§ MetaMask Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯');
                    return;
                }
                
                document.getElementById('btnText').innerText = 'Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...';
                
                // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø­Ø³Ø§Ø¨
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                userAccount = accounts[0];
                walletProvider = window.ethereum;

                // 2. Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ø§ÛŒÙ†ÙÙˆØ±Ø§ (Ù†Ù‡ Ø§Ø² Ú©ÛŒÙ Ù¾ÙˆÙ„)
                await updateInfoFromInfura();

                // 3. Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('btnText').innerText = 'âœ… Ù…ØªØµÙ„ Ø´Ø¯';

                // 4. Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', () => window.location.reload());

            } catch (error) {
                console.error(error);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ' + error.message);
                document.getElementById('btnText').innerText = 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„';
            }
        }

        async function updateInfoFromInfura() {
            if (!userAccount) return;

            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ø§ÛŒÙ†ÙÙˆØ±Ø§
                const network = await infuraWeb3.eth.net.getNetworkType();
                const balance = await infuraWeb3.eth.getBalance(userAccount);
                const balanceInEth = infuraWeb3.utils.fromWei(balance, 'ether');

                // Ù†Ù…Ø§ÛŒØ´
                document.getElementById('address').innerText = 
                    userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                document.getElementById('network').innerText = network + ' (Polygon)';
                document.getElementById('balance').innerText = 
                    parseFloat(balanceInEth).toFixed(4) + ' MATIC';

            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ø§ÛŒÙ†ÙÙˆØ±Ø§:', error);
            }
        }

        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnect();
            } else {
                userAccount = accounts[0];
                updateInfoFromInfura();
            }
        }

        function disconnect() {
            userAccount = null;
            walletProvider = null;
            document.getElementById('walletInfo').style.display = 'none';
            document.getElementById('btnText').innerText = 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„';
        }
    </script>
</body>
</html>
